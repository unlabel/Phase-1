# Знакомство с Sequelize

## Release 0. Подготовить Node проект
Наконец-то мы вернёмся к работе с JavaScript и Node.js. Настрой всё необходимое для работы — инициализируй `package.json`, установи и настрой ESLint и прочие утилиты для удобной разработки. Проверь содержимое `.gitiginore` и отредактируй его, если чего-то не хватает.

Сделай коммит.

## Release 1. Спроектировать таблицу пользователей
Спроектируй одну таблицу для хранения информации о пользователях. Заказчик хочет хранить следующую информацию:

- уникальное имя пользователя, не более 30 символов, только латиница, цифры и знак подчеркивания
- email — уникальный адрес электронной почты, необязательное поле
- номер телефона — уникальный номер телефона в международном формате, необязательное поле
- дата и время создания записи о пользователе
- дата и время последнего изменения информации о пользователе

Нарисуй диаграмму, показывающую структуру таблицы и пропиши названия и типы всех столбцов.

## Release 2. Настроить подключение к базе данных
Установи необходимые библиотеки.

Инициализируй проект с помощью Sequelize CLI. Подправь реквизиты подключения к базе данных.

Поработай в файле `app.js` в корне папки. Подключи к нему экземпляр класса `sequelize` из файла `index.js` в папке `models`.

Напиши функцию `testConnection`, которая будет проверять подключение к базе данных и писать в консоль сообщение о том, что подключение (не) работает. Проверь подключение с помощью метода `authenticate`. Если промис резолвится успешно, то подключение работает.

- [Sequelize API Reference: Sequelize authenticate](https://sequelize.org/api/v6/class/src/sequelize.js~sequelize#instance-method-authenticate)

## Release 2.5. Настроить хранение реквизитов подключения (дополнительно)
Небезопасно хранить реквизиты в коде, который попадёт в Git историю. Это секретная информация, а секретам не место в гите. В идеале хранить секреты в файле, который не попадёт в Git, и передавать их в исполняемый код с помощью переменных окружения — environment variables.

В дальнейшем мы ещё пройдём эту тему, но ты можешь попробовать разобраться в ней самостоятельно. Засеки 30 минут и постарайся понять, как можно это сделать.

30 минут истекли? Не переживай. Пропусти этот дополнительный релиз, сделай коммит — это учебный проект, где можно и нужно делать ошибки — и переходи к следующему релизу.

## Release 3. Создать модель и миграцию
Сгенерируй модель и миграцию при помощи Sequelize CLI. По умолчанию Sequelize создаёт суррогатный ключ `id` и поля с метками времени — `createdAt` и `updatedAt`.

Отредактируй оба файла так, чтобы они соответствовали требованиям заказчика. Запусти миграцию и проверь, что структура таблицы соответствует требованиям. Откати миграцию и проверь, что таблица удалилась.

Если что-то не так, откати миграцию, отредактируй файл миграции и запусти миграцию ещё раз.

Сделай коммит.

## Release 4. Заполнить таблицу данными
У заказчика есть список пользователей, которых нужно добавить в БД:

- prospector_saloon
- dr_mitchell
- peter

Продолжай работать в файле `app.js`.

Напиши функции `addSingleUser` и `addMultipleUsers` для создания одного и нескольких пользователей в БД. Используй методы модели для создания записей в базе данных — например, `create` или `bulkCreate`.

- [Sequelize API Reference: Model create](https://sequelize.org/api/v6/class/src/model.js~model#static-method-create)
- [Sequelize API Reference: Model bulkCreate](https://sequelize.org/api/v6/class/src/model.js~model#static-method-bulkCreate)

Используй свои написанные функции для добавления всех пользователей в БД. Сделай коммит.

## Release 5. Получить список всех пользователей

Заказчик хочет получить список всех пользователей, отсортированных по алфавиту. Напиши функцию `getAllUsers`, которая выводит список пользователей в консоль. Используй метод модели `findAll`.

- [Sequelize API Reference: Model findAll](https://sequelize.org/api/v6/class/src/model.js~model#static-method-findAll)

Сделай коммит.

## Release 6. Добавить колонку для имени пользователя
Заказчик только что вспомнил, что хочет собирать информацию о том, как пользователи хотят, чтобы их звали. Это должно быть простое текстовое поле без ограничений.

Создай новую миграцию с помощью Sequelize CLI — учти, что на этот раз тебе не нужно создавать новую модель. Напиши миграцию так, чтобы она добавляла новую колонку в таблицу пользователей. Не забудь отредактировать метод `down` у миграции — чтобы он удалял колонку из таблицы.

Используй методы `addColumn` и `removeColumn` у `queryInterface`.
- [Sequelize API Reference: QueryInterface addColumn](https://sequelize.org/api/v6/class/src/dialects/abstract/query-interface.js~queryinterface#instance-method-addColumn)
- [Sequelize API Reference: QueryInterface removeColumn](https://sequelize.org/api/v6/class/src/dialects/abstract/query-interface.js~queryinterface#instance-method-removeColumn)

Запусти новую миграцию. Проверь, что новая колонка добавилась в таблицу. Откати миграцию и проверь, что колонка удалилась. Запусти все миграции заново. Проверь данные и заметь, что все твои данные удалены. Это нормально — ведь мы только что удалили все таблицы и создали их заново.

Надеюсь, у тебя сохранён тестовый код для создания пользователей в БД. Запусти его и проверь, что все пользователи добавились в БД. Проверь, что у всех пользователей всё ещё нет имён.

Проверь, как работает добавление новых пользователей — по одному и несколько за раз. Адаптируй функции `addSingleUser` и `addMultipleUsers` так, чтобы они могли принимать имя пользователя для отображения.

Сделай коммит.

## Release 7. Отредактировать записи
Напиши функцию `editSingleUser` для редактирования одного пользователя. Используй метод модели `update`.
- [Sequelize API Reference: Model update](https://sequelize.org/api/v6/class/src/model.js~model#static-method-update)

С помощью этой функции отредактируй существующих пользователей — добавь им имена.

- prospector_saloon: Trudy
- dr_mitchell: Doc Mitchell
- peter: Easy Pete

Сделай коммит.

## Release 7.5. Написать seeder (дополнительно)
Это необязательный релиз — мы ещё будем разбирать написание сидеров в дальнейшем. Но если ты хочешь попробовать, то вперёд! Засеки 30 минут на решение этого релиза.

Напиши сидер, который будет добавлять пользователей в БД. Сидер — это файл, который запускается один раз и добавляет данные в БД. Сидеры можно использовать для наполнения БД тестовыми данными.

Воспользуйся подсказкой Sequelize CLI, чтобы найти нужную команду для создания сидера:

```bash
npx sequelize
```

Используй методы `queryInterface` для заполнения БД данными. Также не забудь заполнить метод `down` для сидера.
- [Sequelize API Reference: QueryInterface](https://sequelize.org/api/v6/class/src/dialects/abstract/query-interface.js~queryinterface)

Сделай коммит.

## Release 8. Найти одну запись
Заказчик хочет реализовать поиск по базе пользователей. Напиши функцию `findUserByName`, которая принимает имя или фрагмент имени пользователя и выполняет поиск по именам для отображения.

Функция должна выводить в лог объект пользователя — в нём должны быть его юзернейм, имя для отображения и дата создания пользователя. Все остальные поля должны быть пропущены. Реализуй такой поиск с помощью метода модели `findOne`.

- [Sequelize API Reference: Model findOne](https://sequelize.org/api/v6/class/src/model.js~Model.html#static-method-findOne)

Если пользователя с таким именем или фрагментом имени не существует, сообщи об этом в логе. Также функция должна возвращать либо `id` найденного пользователя, либо -1, если пользователь не найден.

Сделай коммит.

## Release 9. Подсчитать записи
Реализуй функцию `countUsers`, которая считает количество пользователей в таблице и выводит сообщение в консоль.

Используй методы модели для этого — найди подходящий метод в документации.
- [Sequelize API Reference: Model](https://sequelize.org/api/v6/class/src/model.js~model)

Сделай коммит.

## Release 10. Удалить запись
С помощью реализованной ранее функции `addSingleUser` добавь нового пользователя:

- XXX_joe_XXX: Joe Cobb

Напиши функцию `deleteUserById` — пусть она принимает `id` пользователя и удаляет его из базы. Найди подходящий метод модели в документации.

Найди пользователя с именем "Cobb" с помощью реализованного ранее метода для поиска. Передай полученный `id` в функцию удаления. Проверь, что всё работает.

Сделай коммит.
